#!/usr/bin/python
import os.path
import logging

from loopb.util import localtime_now_filename
from loopb.bview import BView, get_argument_parser
from loopb.bview.store.files import InfiniteImageStore

if __name__ == "__main__":
    parser = get_argument_parser()
    parser.add_argument('--dest', required=True,
                        help='destination directory to store frames')
    parser.add_argument('--format', default='png',
                        help='storage format of image store')

    args = parser.parse_args()

    dest = os.path.abspath(os.path.expanduser(args.dest))
    if not os.path.isdir(dest):
        parser.error('destination directory does not exist')
    dest = os.path.join(dest, localtime_now_filename())

    bview = BView.new_from_commandline_args(args)
    bview.capture.disable_decoding()
    store = InfiniteImageStore(dest, args.format,
                               encoding=bview.capture_metadata.get('encoding', ''))
    bview.attach_framestore(store)
    bview.main()
